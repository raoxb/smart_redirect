### 302重定向需求整理

---

#### **一、核心目标**
将初始URL `api.domain.com/v1/` 动态生成特定格式的短链，通过后台配置实现灵活的重定向逻辑，支持多目标分流、限流及参数处理。

---

#### **二、URL生成规则**
1. **基础结构**  
   - 初始URL：`api.domain.com/v1/`  
   - 生成后的URL格式：`api.domain.com/v1/{bu字段}/{link_id}?network={渠道值}`  
     - 示例：`api.domain.com/v1/bu01/3d5f2a?network=mi`  

2. **字段生成规则**  
   - **业务类型（bu字段）**  
     - 单选框选择业务类型，映射关系：  
       - 非洲业务 → `bu01`  
       - 拉美业务 → `bu02`  
   - **推广渠道（network参数）**  
     - 默认值为 `mi`，支持手动添加其他渠道值（如 `google`、`fb`）。  
   - **链接标识（link_id）**  
     - 根据UUID截取前6位生成，需保证唯一性（如UUID `3d5f2a81-4c...` → `3d5f2a`）。

---

#### **三、管理后台功能**

1. **链接管理**  
   - **基础操作**：添加、删除、修改短链。  
   - **配置项**：  
     - 业务类型选择（bu字段）。  
     - 推广渠道输入（network参数）。  
     - 自动生成link_id（UUID截取前6位）。  

2. **目标链接管理**  
   - **基础操作**：添加、删除、修改目标链接。  
   - **目标链接配置**：  
     - 支持添加多个目标URL（如 `https://aaa.com/hao/1244687`）。  
     - 可为每个目标设置流量配比（如目标1:70%、目标2:30%）。  
   - **链接限流规则**：
     - ip限流: 同一IP在一定间隔内(比如12小时)多次访问，优先分配未使用过的目标链接。  
     - 地域限流: 只有限定国家的ip可给分配该目标链接
     - caps限制: 单个目标链接的访问限额，超过限额不能再重定向到该链接
   - **链接参数处理规则**：
     - **参数替换**：  
     - 支持配置映射规则（如将原始参数 `kw` 转换为目标参数 `q`）。  
     - **参数拼接**：  
     - 可静态添加参数（如 `refer=ff01`、`s1=aaa`）。  
   - **api批量添加链接** 

3. **总限额设置**
  - **限额大小设置**
    总caps, 当总访问量达到阈值时，所有流量重定向到备用链接。  
  - **备用链接设备**
    超过总caps之后，重定向到备用链接

4. **账号管理**
    添加、删除、修改;

5. **链接分配**
    把链接分配给一个或多个账号，使用对应账号登陆可查看和管理对应链接
    
---

#### **五、示例场景**
1. **生成短链**  
   - 用户选择“非洲业务”，渠道为 `mi`，生成URL：`api.domain.com/v1/bu01/3d5f2a?network=mi`。  
2. **分流与跳转**  
   - 70%流量跳转至 `https://aaa.com/hao/1244687`，30%至 `https://bbb.com/hao/1324168`。  
3. **限流触发**  
   - 总访问量达1万次后，所有请求跳转至备用链接 `https://backup.com`。  

